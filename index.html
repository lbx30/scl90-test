<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCL-90症状自评量表测试</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff6b6b;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .description {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 18px;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .question-container {
            margin-bottom: 20px;
        }
        
        .question-number {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .question-text {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .options {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .option {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option:hover {
            background-color: #f5f7fa;
            border-color: var(--primary-color);
        }
        
        .option.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .hidden {
            display: none;
        }
        
        .result-section {
            margin-bottom: 30px;
        }
        
        .result-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .factor-score {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .factor-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .score-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        .score-text {
            font-size: 14px;
            color: #666;
        }
        
        .interpretation {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .normal {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .mild {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .moderate {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .severe {
            background-color: #fce4ec;
            color: #ad1457;
        }
        
        .warning-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }
        
        .resources {
            margin-top: 30px;
        }
        
        .resource-list {
            list-style-type: none;
        }
        
        .resource-list li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .resource-list li:before {
            content: "•";
            color: var(--primary-color);
            position: absolute;
            left: 0;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .summary-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .summary-title {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .summary-description {
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .auto-next-checkbox {
            margin: 15px 0;
            display: flex;
            align-items: center;
        }
        
        .auto-next-checkbox input {
            margin-right: 8px;
        }
        
        .result-explanation {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .severity-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .severity-level {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .severity-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SCL-90症状自评量表</h1>
            <p class="description">SCL-90是一种广泛使用的心理健康自评量表，包含90个项目，涵盖9个症状维度，帮助您了解近一周的心理健康状况。</p>
        </header>
        
        <!-- 介绍页面 -->
        <div id="intro-page" class="card">
            <h2>测试说明</h2>
            <p>本测试包含90个问题，大约需要15-20分钟完成。请根据您<strong>最近一周</strong>的实际感受选择最符合的选项。</p>
            
            <div class="warning-box">
                <strong>重要提示：</strong>本测试结果仅供参考，不能替代专业医疗诊断。如果您感到严重不适，请及时寻求专业医疗帮助。
            </div>
            
            <h3>评分标准：</h3>
            <ul>
                <li><strong>1分 - 从无：</strong>自觉并无该项症状</li>
                <li><strong>2分 - 很轻：</strong>自觉有该症状，但发生得并不频繁、严重</li>
                <li><strong>3分 - 中等：</strong>自觉有该项症状，其严重程度为轻到中度</li>
                <li><strong>4分 - 偏重：</strong>自觉常有该项症状，其程度为中到严重</li>
                <li><strong>5分 - 严重：</strong>自觉该症状的频度和强度都十分严重</li>
            </ul>
            
            <div class="auto-next-checkbox">
                <input type="checkbox" id="auto-next" checked>
                <label for="auto-next">答完一题后自动跳转到下一题</label>
            </div>
            
            <button id="start-test" class="btn btn-large btn-block">开始测试</button>
        </div>
        
        <!-- 测试页面 -->
        <div id="test-page" class="card hidden">
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
            
            <div id="question-container" class="question-container">
                <!-- 问题将通过JavaScript动态加载 -->
            </div>
            
            <div class="navigation">
                <button id="prev-btn" class="btn">上一题</button>
                <button id="next-btn" class="btn">下一题</button>
            </div>
        </div>
        
        <!-- 结果页面 -->
        <div id="result-page" class="hidden">
            <!-- 总结卡片 -->
            <div id="summary-card" class="summary-card">
                <div id="summary-icon" class="summary-icon">😊</div>
                <h2 id="summary-title" class="summary-title">测试完成</h2>
                <p id="summary-description" class="summary-description">您的测试结果已生成，请查看详细报告</p>
            </div>
            
            <div class="card">
                <h2>测试结果</h2>
                <p>以下是您的SCL-90测试结果分析：</p>
                
                <div class="result-section">
                    <h3 class="result-title">总体症状指数</h3>
                    <div class="factor-score">
                        <div class="factor-name">总症状指数 (GSI)</div>
                        <div class="score-bar">
                            <div id="gsi-bar" class="score-fill" style="width: 0%; background-color: var(--primary-color);"></div>
                        </div>
                        <div id="gsi-score" class="score-text">得分: 计算中...</div>
                        <div id="gsi-interpretation" class="interpretation"></div>
                    </div>
                    
                    <div class="factor-score">
                        <div class="factor-name">总分</div>
                        <div id="total-score" class="score-text">总分: 计算中...</div>
                        <div id="total-interpretation" class="interpretation"></div>
                    </div>
                </div>
                
                <div class="result-section">
                    <h3 class="result-title">各症状维度分析</h3>
                    <div id="factors-container">
                        <!-- 各因子分数将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <div class="result-section">
                    <h3 class="result-title">测试情况分级</h3>
                    <div class="severity-levels">
                        <div class="severity-level normal">
                            <div class="severity-title">轻微 (1.0-2.0分)</div>
                            <div>症状轻微或偶尔出现</div>
                        </div>
                        <div class="severity-level mild">
                            <div class="severity-title">轻度 (2.0-3.0分)</div>
                            <div>症状明显但不影响日常生活</div>
                        </div>
                        <div class="severity-level moderate">
                            <div class="severity-title">中度 (3.0-4.0分)</div>
                            <div>症状明显且对日常生活有一定影响</div>
                        </div>
                        <div class="severity-level severe">
                            <div class="severity-title">重度 (4.0-5.0分)</div>
                            <div>症状严重且明显影响日常生活</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-section">
                    <h3 class="result-title">结果解释</h3>
                    <div class="result-explanation">
                        <p>请用从容的心态来看待本次测试。无论分数如何，请一定记得，我们始终都在你身边。SCL-90 心理健康自评量表涵盖了情绪状态、思维模式、人际关系、生活习惯等多个维度，它就像一面温柔的镜子，能帮你更清晰地看见自己当下的心理状态。</p>
                        
                        <p>需要知道的是，量表得分仅仅是近期心理感受的投射。若某些因子得分较高，或许只是说明你最近在这些方面暂时感受到了压力或困扰，但这绝不等于你存在严重的问题，很多时候，短期的心理波动本就是生活的常态 -- 可能是学习的节奏、工作的挑战，或是人际交往中的小插曲带来的暂时影响。</p>
                        
                        <p>如果你发现自己在多个维度上长期感到不适，不妨多给自己一些关注:试着调整自己的作息规律，找到适合自己的放松方式，或是和信任的人好好倾诉聊聊。倘若情绪已经悄悄影响到了日常生活，且靠自己难以调节，也请不要犹豫，及时寻求专业的心理咨询或帮助，这并不是软弱，而是对自己的负责。要知道，心理健康和身体健康同样重要，而你，本就值得被好好关心与坚定支持。</p>
                        
                        <p>按中国常模结果，如果您的SCL90总分超过160分，单项均分超过2分就应作进一步检查，标准分为大于200分说明你有很明显的心理问题，可求助于心理咨询，大于250分则比较严重，需要作医学上的详细检查，很可能要做针对性的心理治疗或在医生的指导下服药。</p>
                    </div>
                </div>
                
                <div class="warning-box">
                    <strong>重要提示：</strong>本测试结果仅供参考，不能作为临床诊断依据。如果您的测试结果显示有中度或重度症状，或您感到明显不适，建议您尽快咨询心理健康专业人士。
                </div>
                
                <div class="resources">
                    <h3>心理健康资源</h3>
                    <ul class="resource-list">
                        <li>全国心理援助热线：12320-5</li>
                    </ul>
                </div>
                
                <div class="navigation">
                    <button id="retake-test" class="btn">重新测试</button>
                    <button id="save-report" class="btn btn-success">保存报告</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>© 2023 心理健康服务平台 | 本测试结果仅供参考，不能替代专业医疗建议</p>
    </footer>

    <script>
        // SCL-90完整问题列表
        const questions = [
            { id: 1, text: "头痛", factor: "somatization" },
            { id: 2, text: "神经过敏，心中不踏实", factor: "anxiety" },
            { id: 3, text: "头脑中有不必要的想法或字句盘旋", factor: "obsessive" },
            { id: 4, text: "头晕或昏倒", factor: "somatization" },
            { id: 5, text: "对异性的兴趣减退", factor: "interpersonal" },
            { id: 6, text: "对旁人责备求全", factor: "hostility" },
            { id: 7, text: "感到别人能控制您的思想", factor: "psychoticism" },
            { id: 8, text: "责怪别人制造麻烦", factor: "hostility" },
            { id: 9, text: "忘记性大", factor: "obsessive" },
            { id: 10, text: "担心自己的衣饰整齐及仪态的端正", factor: "anxiety" },
            { id: 11, text: "容易烦恼和激动", factor: "hostility" },
            { id: 12, text: "胸痛", factor: "somatization" },
            { id: 13, text: "害怕空旷的场所或街道", factor: "phobic" },
            { id: 14, text: "感到自己的精力下降，活动减慢", factor: "depression" },
            { id: 15, text: "想结束自己的生命", factor: "depression" },
            { id: 16, text: "听到旁人听不到的声音", factor: "psychoticism" },
            { id: 17, text: "发抖", factor: "anxiety" },
            { id: 18, text: "感到大多数人都不可信任", factor: "paranoid" },
            { id: 19, text: "胃口不好", factor: "additional" },
            { id: 20, text: "容易哭泣", factor: "depression" },
            { id: 21, text: "同异性相处时感到害羞不自在", factor: "interpersonal" },
            { id: 22, text: "感到受骗，中了圈套或有人想抓住您", factor: "depression" },
            { id: 23, text: "无缘无故地突然感到害怕", factor: "anxiety" },
            { id: 24, text: "自己不能控制地大发脾气", factor: "hostility" },
            { id: 25, text: "怕单独出门", factor: "phobic" },
            { id: 26, text: "经常责怪自己", factor: "depression" },
            { id: 27, text: "腰痛", factor: "somatization" },
            { id: 28, text: "感到难以完成任务", factor: "obsessive" },
            { id: 29, text: "感到孤独", factor: "depression" },
            { id: 30, text: "感到苦闷", factor: "depression" },
            { id: 31, text: "过分担忧", factor: "depression" },
            { id: 32, text: "对事物不感兴趣", factor: "depression" },
            { id: 33, text: "感到害怕", factor: "anxiety" },
            { id: 34, text: "您的感情容易受到伤害", factor: "interpersonal" },
            { id: 35, text: "旁人能知道您的私下想法", factor: "psychoticism" },
            { id: 36, text: "感到别人不理解您、不同情愫您", factor: "interpersonal" },
            { id: 37, text: "感到人们对您不友好，不喜欢您", factor: "interpersonal" },
            { id: 38, text: "做事必须做得很慢以保证做得正确", factor: "obsessive" },
            { id: 39, text: "心跳得很厉害", factor: "anxiety" },
            { id: 40, text: "恶心或胃部不舒服", factor: "somatization" },
            { id: 41, text: "感到比不上他人", factor: "interpersonal" },
            { id: 42, text: "肌肉酸痛", factor: "somatization" },
            { id: 43, text: "感到有人在监视您、谈论您", factor: "paranoid" },
            { id: 44, text: "难以入睡", factor: "additional" },
            { id: 45, text: "做事必须反复检查", factor: "obsessive" },
            { id: 46, text: "难以作出决定", factor: "obsessive" },
            { id: 47, text: "怕乘电车、公共汽车、地铁或火车", factor: "phobic" },
            { id: 48, text: "呼吸有困难", factor: "somatization" },
            { id: 49, text: "一阵阵发冷或发热", factor: "somatization" },
            { id: 50, text: "因为感到害怕而避开某些东西、场合或活动", factor: "phobic" },
            { id: 51, text: "脑子变空了", factor: "obsessive" },
            { id: 52, text: "身体发麻或刺痛", factor: "somatization" },
            { id: 53, text: "喉咙有梗塞感", factor: "somatization" },
            { id: 54, text: "感到前途没有希望", factor: "depression" },
            { id: 55, text: "不能集中注意力", factor: "obsessive" },
            { id: 56, text: "感到身体的某一部分软弱无力", factor: "somatization" },
            { id: 57, text: "感到紧张或容易紧张", factor: "anxiety" },
            { id: 58, text: "感到手或脚发重", factor: "somatization" },
            { id: 59, text: "想到死亡的事", factor: "additional" },
            { id: 60, text: "吃得太多", factor: "additional" },
            { id: 61, text: "当别人看着您或谈论您时感到不自在", factor: "interpersonal" },
            { id: 62, text: "有一些不属于您自己的想法", factor: "psychoticism" },
            { id: 63, text: "有想打人或伤害他人的冲动", factor: "hostility" },
            { id: 64, text: "醒得太早", factor: "additional" },
            { id: 65, text: "必须反复洗手、点数日或触摸某些东西", factor: "obsessive" },
            { id: 66, text: "睡得不稳不深", factor: "additional" },
            { id: 67, text: "有想摔坏或破坏东西的冲动", factor: "hostility" },
            { id: 68, text: "有一些别人没有的想法或念头", factor: "paranoid" },
            { id: 69, text: "感到对别人神经过敏", factor: "interpersonal" },
            { id: 70, text: "在商店或电影院等人多的地方感到不自在", factor: "phobic" },
            { id: 71, text: "感到任何事情都很困难", factor: "depression" },
            { id: 72, text: "一阵阵恐惧或惊恐", factor: "anxiety" },
            { id: 73, text: "感到在公共场合吃东西很不舒服", factor: "interpersonal" },
            { id: 74, text: "经常与人争论", factor: "hostility" },
            { id: 75, text: "单独一人时神经很紧张", factor: "phobic" },
            { id: 76, text: "别人对您的成绩没有作出恰当的评价", factor: "paranoid" },
            { id: 77, text: "即使和别人在一起也感到孤单", factor: "psychoticism" },
            { id: 78, text: "感到坐立不安心神不定", factor: "anxiety" },
            { id: 79, text: "感到自己没有什么价值", factor: "depression" },
            { id: 80, text: "感到熟悉的东西变成陌生或不像是真的", factor: "anxiety" },
            { id: 81, text: "大叫或摔东西", factor: "hostility" },
            { id: 82, text: "害怕会在公共场合昏倒", factor: "phobic" },
            { id: 83, text: "感到别人想占您的便宜", factor: "paranoid" },
            { id: 84, text: "为一些有关性的想法而很苦恼", factor: "psychoticism" },
            { id: 85, text: "您认为应该因为自己的过错而受到惩罚", factor: "psychoticism" },
            { id: 86, text: "感到要很快把事情做完", factor: "anxiety" },
            { id: 87, text: "感到自己的身体有严重问题", factor: "psychoticism" },
            { id: 88, text: "从未感到和其他人很亲近", factor: "psychoticism" },
            { id: 89, text: "感到自己有罪", factor: "additional" },
            { id: 90, text: "感到自己的脑子有毛病", factor: "psychoticism" }
        ];
        
        // 因子信息
        const factors = {
            somatization: { 
                name: "躯体化", 
                items: [1, 4, 12, 27, 40, 42, 48, 49, 52, 53, 56, 58],
                description: "反映主观的身体不适感，包括心血管、胃肠道、呼吸和其他系统的主诉不适，以及头痛、背痛、肌肉酸痛等其他躯体表现。"
            },
            obsessive: { 
                name: "强迫症状", 
                items: [3, 9, 10, 28, 38, 45, 46, 51, 55, 65],
                description: "主要指那些明知没有必要，但又无法摆脱的无意义的思想、冲动和行为等表现。"
            },
            interpersonal: { 
                name: "人际关系敏感", 
                items: [6, 21, 34, 36, 37, 41, 61, 69, 73],
                description: "指某些个人不自在感与自卑感，尤其是在与其他人相比较时更突出。"
            },
            depression: { 
                name: "抑郁", 
                items: [5, 14, 15, 20, 22, 26, 29, 30, 31, 32, 54, 71, 79],
                description: "反映与临床抑郁症状群相联系的广泛概念，忧郁苦闷的感情和心境是代表性症状。"
            },
            anxiety: { 
                name: "焦虑", 
                items: [2, 17, 23, 33, 39, 57, 72, 78, 80, 86],
                description: "指那些无法静息、神经过敏、紧张以及由此产生的躯体征象，如震颤等。"
            },
            hostility: { 
                name: "敌对", 
                items: [11, 24, 63, 67, 74, 81],
                description: "主要从思想、感情及行为三方面来反映敌对的表现。"
            },
            phobic: { 
                name: "恐怖", 
                items: [13, 25, 47, 50, 70, 75, 82],
                description: "反映对孤独、公共场合和交通工具等的恐惧程度。"
            },
            paranoid: { 
                name: "偏执", 
                items: [8, 18, 43, 68, 76, 83],
                description: "主要指思维方面，如投射性思维、敌对、猜疑、关系观念、妄想、被动体验和夸大等。"
            },
            psychoticism: { 
                name: "精神病性", 
                items: [7, 16, 35, 62, 77, 84, 85, 87, 88, 90],
                description: "反映各式各样的急性症状和行为，也可代表精神病性过程的指征。"
            },
            additional: { 
                name: "其他", 
                items: [19, 44, 59, 60, 64, 66, 89],
                description: "主要反映睡眠及饮食情况。"
            }
        };
        
        // 当前测试状态
        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(0);
        let autoNextEnabled = true;
        
        // DOM元素
        const introPage = document.getElementById('intro-page');
        const testPage = document.getElementById('test-page');
        const resultPage = document.getElementById('result-page');
        const startTestBtn = document.getElementById('start-test');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const questionContainer = document.getElementById('question-container');
        const progressBar = document.getElementById('progress');
        const retakeTestBtn = document.getElementById('retake-test');
        const saveReportBtn = document.getElementById('save-report');
        const factorsContainer = document.getElementById('factors-container');
        const autoNextCheckbox = document.getElementById('auto-next');
        const summaryCard = document.getElementById('summary-card');
        const summaryIcon = document.getElementById('summary-icon');
        const summaryTitle = document.getElementById('summary-title');
        const summaryDescription = document.getElementById('summary-description');
        
        // 事件监听
        startTestBtn.addEventListener('click', startTest);
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);
        retakeTestBtn.addEventListener('click', retakeTest);
        saveReportBtn.addEventListener('click', saveReport);
        autoNextCheckbox.addEventListener('change', function() {
            autoNextEnabled = this.checked;
        });
        
        // 开始测试
        function startTest() {
            introPage.classList.add('hidden');
            testPage.classList.remove('hidden');
            showQuestion(currentQuestion);
        }
        
        // 显示问题
        function showQuestion(index) {
            // 更新进度条
            const progress = ((index + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // 生成问题HTML
            const question = questions[index];
            let optionsHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                let optionText = '';
                switch(i) {
                    case 1: optionText = '从无'; break;
                    case 2: optionText = '很轻'; break;
                    case 3: optionText = '中等'; break;
                    case 4: optionText = '偏重'; break;
                    case 5: optionText = '严重'; break;
                }
                
                const selectedClass = answers[index] === i ? 'selected' : '';
                optionsHTML += `
                    <div class="option ${selectedClass}" data-value="${i}">
                        ${i}. ${optionText}
                    </div>
                `;
            }
            
            questionContainer.innerHTML = `
                <div class="question-number">问题 ${index + 1} / ${questions.length}</div>
                <div class="question-text">${question.text}</div>
                <div class="options">${optionsHTML}</div>
            `;
            
            // 添加选项点击事件
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    // 移除其他选项的选中状态
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // 设置当前选项为选中状态
                    this.classList.add('selected');
                    
                    // 保存答案
                    answers[index] = parseInt(this.getAttribute('data-value'));
                    
                    // 如果已回答，启用下一题按钮
                    if (answers[index] > 0) {
                        nextBtn.disabled = false;
                    }
                    
                    // 如果启用了自动跳转，自动跳转到下一题
                    if (autoNextEnabled && answers[index] > 0 && index < questions.length - 1) {
                        setTimeout(() => {
                            nextQuestion();
                        }, 500);
                    }
                });
            });
            
            // 更新导航按钮状态
            prevBtn.disabled = index === 0;
            nextBtn.disabled = answers[index] === 0;
            
            // 如果是最后一题，更改按钮文本
            if (index === questions.length - 1) {
                nextBtn.textContent = '查看结果';
            } else {
                nextBtn.textContent = '下一题';
            }
        }
        
        // 上一题
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }
        
        // 下一题
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else {
                // 最后一题，显示结果
                showResults();
            }
        }
        
        // 显示结果
        function showResults() {
            testPage.classList.add('hidden');
            resultPage.classList.remove('hidden');
            
            // 计算各因子分数
            const factorScores = calculateFactorScores();
            
            // 显示总体症状指数
            const gsi = calculateGSI();
            document.getElementById('gsi-score').textContent = `得分: ${gsi.toFixed(2)}`;
            document.getElementById('gsi-bar').style.width = `${Math.min(gsi / 5 * 100, 100)}%`;
            
            let gsiInterpretation = '';
            if (gsi < 1.5) {
                gsiInterpretation = '您的总体症状指数在正常范围内。';
            } else if (gsi < 2.5) {
                gsiInterpretation = '您的总体症状指数显示有轻度症状。';
            } else if (gsi < 3.5) {
                gsiInterpretation = '您的总体症状指数显示有中度症状，建议关注心理健康。';
            } else {
                gsiInterpretation = '您的总体症状指数显示有较严重症状，建议寻求专业帮助。';
            }
            document.getElementById('gsi-interpretation').textContent = gsiInterpretation;
            document.getElementById('gsi-interpretation').className = `interpretation ${getSeverityClass(gsi)}`;
            
            // 显示总分
            const totalScore = calculateTotalScore();
            document.getElementById('total-score').textContent = `总分: ${totalScore}`;
            
            let totalInterpretation = '';
            if (totalScore < 160) {
                totalInterpretation = '您的总分在正常范围内。';
            } else if (totalScore < 200) {
                totalInterpretation = '您的总分超过160分，建议作进一步检查。';
            } else if (totalScore < 250) {
                totalInterpretation = '您的总分超过200分，说明有明显的心理问题，可求助于心理咨询。';
            } else {
                totalInterpretation = '您的总分超过250分，情况比较严重，需要作医学上的详细检查。';
            }
            document.getElementById('total-interpretation').textContent = totalInterpretation;
            document.getElementById('total-interpretation').className = `interpretation ${getSeverityClass(totalScore/90)}`;
            
            // 更新总结卡片
            updateSummaryCard(gsi, totalScore, factorScores);
            
            // 显示各因子分数
            factorsContainer.innerHTML = '';
            for (const [key, factor] of Object.entries(factors)) {
                const score = factorScores[key] || 0;
                const severityClass = getSeverityClass(score);
                
                const factorHTML = `
                    <div class="factor-score">
                        <div class="factor-name">${factor.name}</div>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${Math.min(score / 5 * 100, 100)}%; background-color: var(--primary-color);"></div>
                        </div>
                        <div class="score-text">得分: ${score.toFixed(2)}</div>
                        <div class="interpretation ${severityClass}">${getInterpretation(score, factor.name)}</div>
                    </div>
                `;
                
                factorsContainer.innerHTML += factorHTML;
            }
        }
        
        // 更新总结卡片
        function updateSummaryCard(gsi, totalScore, factorScores) {
            let maxSeverity = 'normal';
            let maxSeverityScore = 0;
            
            // 找出最严重的因子
            for (const [key, score] of Object.entries(factorScores)) {
                if (score > maxSeverityScore) {
                    maxSeverityScore = score;
                    maxSeverity = getSeverityClass(score);
                }
            }
            
            // 根据最严重因子设置总结卡片
            switch(maxSeverity) {
                case 'normal':
                    summaryIcon.textContent = '😊';
                    summaryTitle.textContent = '心理健康状况良好';
                    summaryDescription.textContent = '您的测试结果显示心理健康状况良好，各项指标均在正常范围内。';
                    summaryCard.style.backgroundColor = '#e8f5e9';
                    break;
                case 'mild':
                    summaryIcon.textContent = '😐';
                    summaryTitle.textContent = '轻度症状';
                    summaryDescription.textContent = '您的测试结果显示存在轻度症状，建议适当关注心理健康。';
                    summaryCard.style.backgroundColor = '#fff3e0';
                    break;
                case 'moderate':
                    summaryIcon.textContent = '😟';
                    summaryTitle.textContent = '中度症状';
                    summaryDescription.textContent = '您的测试结果显示存在中度症状，建议寻求专业评估和帮助。';
                    summaryCard.style.backgroundColor = '#ffebee';
                    break;
                case 'severe':
                    summaryIcon.textContent = '😔';
                    summaryTitle.textContent = '较严重症状';
                    summaryDescription.textContent = '您的测试结果显示存在较严重症状，强烈建议寻求专业医疗帮助。';
                    summaryCard.style.backgroundColor = '#fce4ec';
                    break;
            }
        }
        
        // 计算各因子分数
        function calculateFactorScores() {
            const scores = {};
            
            for (const [key, factor] of Object.entries(factors)) {
                let total = 0;
                let count = 0;
                
                // 计算该因子下所有问题的总分
                factor.items.forEach(itemId => {
                    const questionIndex = itemId - 1;
                    if (answers[questionIndex] > 0) {
                        total += answers[questionIndex];
                        count++;
                    }
                });
                
                // 计算平均分
                scores[key] = count > 0 ? total / count : 0;
            }
            
            return scores;
        }
        
        // 计算总体症状指数(GSI)
        function calculateGSI() {
            let total = 0;
            let count = 0;
            
            // 计算所有问题的总分
            answers.forEach(answer => {
                if (answer > 0) {
                    total += answer;
                    count++;
                }
            });
            
            // 计算平均分
            return count > 0 ? total / count : 0;
        }
        
        // 计算总分
        function calculateTotalScore() {
            let total = 0;
            
            // 计算所有问题的总分
            answers.forEach(answer => {
                if (answer > 0) {
                    total += answer;
                }
            });
            
            return total;
        }
        
        // 根据分数获取严重程度类别
        function getSeverityClass(score) {
            if (score < 1.5) return 'normal';
            if (score < 2.5) return 'mild';
            if (score < 3.5) return 'moderate';
            return 'severe';
        }
        
        // 获取解释文本
        function getInterpretation(score, factorName) {
            if (score < 1.5) {
                return `您在${factorName}维度上的得分在正常范围内。`;
            } else if (score < 2.5) {
                return `您在${factorName}维度上有轻度症状，建议适当关注。`;
            } else if (score < 3.5) {
                return `您在${factorName}维度上有中度症状，建议寻求专业评估。`;
            } else {
                return `您在${factorName}维度上有较严重症状，强烈建议寻求专业帮助。`;
            }
        }
        
        // 重新测试
        function retakeTest() {
            currentQuestion = 0;
            answers = new Array(questions.length).fill(0);
            resultPage.classList.add('hidden');
            introPage.classList.remove('hidden');
        }
        
        // 保存报告
        function saveReport() {
            alert('报告保存功能将在完整版中实现。在实际应用中，这里可以生成PDF或保存到用户账户。');
        }
    </script>
</body>

</html>
